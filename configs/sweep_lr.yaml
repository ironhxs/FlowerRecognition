# Hydra Multirun 超参数扫描配置
# 用法: python train.py -cn sweep_lr --multirun
# 自动运行多个实验，找出最佳学习率和正则化组合

defaults:
  - config  # 继承基础配置
  - model: swin_v2_optimized
  - dataset: flower100
  - augmentation: medium
  - _self_

# 基础路径（和 swin_v2_anti_overfit 一致）
checkpoint_dir: /root/autodl-tmp/checkpoints_sweep
log_dir: /root/tf-logs/sweep

# 训练设置
dataset:
  batch_size: 128
  val_split: 0.15
  num_workers: 4

# 超参数扫描范围
training:
  # 学习率扫描（小范围精细调优）
  optimizer:
    name: AdamW
    lr: 1.0e-5, 1.5e-5, 2.0e-5, 2.5e-5  # 4 个候选值
    betas: [0.9, 0.999]
    weight_decay: 0.12, 0.15, 0.18      # 3 个候选值
    eps: 1.0e-8
  
  # 学习率调度器
  scheduler:
    name: cosine
    warmup_epochs: 3
    min_lr: 5.0e-7
    warmup_lr: 5.0e-7
  
  # 训练轮数（快速实验）
  epochs: 30  # 30 epochs 足以看出趋势
  
  # 正则化
  label_smoothing: 0.15, 0.2  # 2 个候选值
  drop_path_rate: 0.3, 0.35   # 2 个候选值
  
  # 损失函数
  loss_function: focal
  focal_alpha: 0.25
  focal_gamma: 2.0
  
  # 早停
  early_stopping:
    patience: 10
    min_delta: 0.001
    mode: max
    monitor: val_acc
  
  # 其他设置
  use_amp: true
  clip_grad_norm: 1.0
  val_every: 1
  save_every: 10

# Hydra Sweeper 配置
hydra:
  sweeper:
    params:
      training.optimizer.lr: 1.0e-5,1.5e-5,2.0e-5,2.5e-5
      training.optimizer.weight_decay: 0.12,0.15,0.18
      training.label_smoothing: 0.15,0.2
      training.drop_path_rate: 0.3,0.35
